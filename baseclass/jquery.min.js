((e,t,a,r)=>{new URL(e.currentScript.src),new URLSearchParams(location.search).get("family-calendar");let[n,i,l,o,c,d,s,h,p,m,g]="family-calendar,current,month,event,calendar,background,highlight,branch,person,child,partners".split(","),u="family-branch",b=l+"-grid",f=c+"-"+l,y=o+"-"+p,w=o+"-"+g,A=o+"-death",$=l+"-name",v=c+"-"+l+"-events",M=o+"-label",S=o+"-age",k="left-column",x="right-column",L="relation-column",H="relation-icon",D=o+"-day",T=o+"-year",E="death",F="ex",V="name",z="branchonly",B="showpartners",R="showdeaths",j=i+l,C="upcoming-"+o,K="not"+C,N="relation-"+s,Y="divorced",U=c+"-"+d,Z=c+"-color",q=l+"-"+d,J=l+"name-"+d,O=l+"name-color",_=i+l+"-"+d,G=i+l+"-color",I=i+l+"name-"+d,Q=i+l+"name-color",P=s+"-"+d,W=s+"-family-"+d,X=s+"-hover-"+d,ee=s+"-deceased-hover-"+d,te={[U]:"#bdb76b",[Z]:"#000080",[q]:"#eee8aa",[J]:"#bdb76b",[O]:"#000000",[_]:"#eee8aa",[I]:"#bdb76b",[Q]:"#000080",[P]:"#ffcc00",[W]:"#ffeb00",[X]:"#ffa500",[ee]:"#ffa500"},ae=(e,t)=>`${e}{${t}}`,re=(e,t,a)=>`var(--${e}${t?"-"+t:""}${a?" , "+a:""})`,ne="display:inline-block;",ie="display:none;",le=e=>`[${e}]`,oe=e=>`background:${e}`,ce=e=>`opacity:${e}`,de=e=>`[part~=${e}]`,se=(e,t=h+"*")=>le(t+`="${e}"i`),he=e=>`:host(${e})`,pe=e=>`:not(${e})`,me=(e,t,a,r=oe(re(e)))=>(t&&(r+=`;color:${re(t)}`),a&&(r+=";"+ce(a)),r),ge=(e,t)=>`${b}{display:grid;grid:repeat(${t},1fr)/repeat(${e},1fr);gap:2px}`,ue=e=>`<svg viewBox='0 0 40 40'>${{Q:"<path fill=red d='M20 37V20ZM37 13H22l7-4A4 4 0 0024 5l-4 7-3-7a4 4 0 10-5 5l6 3H4v6l2 2H35l2-2Zm-3 7H7V35l2 2H32l2-2V20Z' stroke-width=2 stroke=black />",U:"<circle cx=12 r=4 cy=18 /><circle cx=30 r=4 cy=5 /><path d='m8 23c-1 1-3 6-3 6-1 2 1 2 2 1l2-4v13c0 2 3 2 3 0V30h1v7c0 2 3 2 3 0V25l4-4c1-3 1-3-1-2l-3 3zm15-9v23c0 3 4 3 4 0V23h2v14c0 3 4 3 4 0V14h1v8c0 2 3 2 3 0V13c0-3-2-4-4-4H24c-1 0-2 1-3 2l-5 9c-1 2 2 3 3 1l4-7z'/>",T:"<path fill=red d='M18 15c1 0 2-1 4-3 2-1 3-3 4-4 1-1 1-2 1-4 0-3-2-5-5-5-2 0-3 2-4 2-1-1-2-2-4-2-3 0-5 2-5 5 0 2 1 3 1 4 1 2 6 6 8 6z'/><circle cy=25 r=10 stroke-width=3 stroke=black fill=none cx=12 /><circle cy=25 r=10 stroke-width=3 stroke=black fill=none cx=25 />",partners:"<path fill=red d='M12 10c-4 0-7 3-7 7c0 8 8 10 13 18c5-8 13-10 13-18a7 7 90 00-13-3c-1-3-4-4-6-4z' stroke=black />"}[e]}</svg>`,be=(a,r={})=>t(e.createElement(a),r),fe=e=>e?e.textContent.trim():"",ye=e=>r({length:12},((t,a)=>new Date(1,a,1).toLocaleString(e,{month:"long"}))),we=ye("us");customElements.define(n,class extends HTMLElement{createElement(){}async connectedCallback(){let n=this,i=ye(n.getAttribute(l+"-locale")||navigator.language),c=new Date(n.getAttribute("today")),d=e=>{if(e){"string"!=typeof e&&(e=[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-"));let[t,a,r]=e.split(/[-\/]/).map((e=>~~e)),n=new Date(e),i=c||new Date,l=new Date(i.getFullYear(),a-1,r),o=Math.ceil((l-i)/864e5);return o<0&&(l=new Date(i.getFullYear()+1,a-1,r),o=Math.ceil((l-i)/864e5)),{B:n,year:t,month:a,day:r,A:i.getFullYear()-n.getFullYear()-(i.getMonth()<n.getMonth()||i.getMonth()==n.getMonth()&&i.getDate()<n.getDate()?1:0),C:o,N:String(t).slice(-2),M:we[a-1],I:t+we[a-1]+r}}};n.person=e=>n.grid.querySelector(y+se(e,"id^")),n.aa=(e,t)=>r(n.grid.querySelectorAll(`[id="${e?.id}"]`)).map((e=>e.part.toggle(N,t)));let s=0,ee=e.createDocumentFragment(),Ae=e.createDocumentFragment(),$e=n.events={};we.map((e=>$e[e]=[])),this.render=(e=[],l,s)=>{Ae.append(...r(ee.children).map((function t(a,n=a.getAttribute(V)||fe(a)||V,i,o,c=a.localName){if(c==g)o=be(w),(s=r(a.children))[0].J=s[1],s[1].J=s[0];else if(c==p||c==m)o=be(y),a.getAttribute(E)&&((i=be(A,{S:{R:a,L:n,F:d(a.getAttribute("date"))}})).setAttribute("date",a.getAttribute(E)),e.push([o,i]));else{if(c!=h)return;(o=be(u)).setAttribute(V,n=a.getAttribute(V)||666)}o.S={L:n,R:a};for(let e of r(a.attributes))o.setAttribute(e.name,e.value);for(let e of r(a.children))(l=t(e))&&o.append(l);return o}))),e.map((([e,t])=>e.after(t)));let P=(e,a=[],{localName:i,S:l}=e,c=(i==u?[...a,e.getAttribute(V)]:a),s,p)=>{if(l.K=r(new Set(c)).reverse(),i!=u&&(t(l,{E:d(e.getAttribute("date")),O:e.getAttribute(z),G:d(l.R.getAttribute(E))}),s=l.E)){let{L:t,F:a,K:c,G:d,R:m,R:{children:u,J:b}}=l,f="",$=t,v="",E=c[0],V="",B=[o,i],R=(e,t)=>`<${e} part="${e}">${t}</${e}>`,j=(e,t)=>~~Math.round((t.getTime()-e.getTime())/315576e5),N=!d&&s.C<(n.getAttribute("days")||28);i==A?($="†&nbsp;"+$,v=R(S,j(a.B,d.B))):i==y?d?(f=R("death-info",`&nbsp;†${R(T,"'"+d.N)}`),v=R(S,j(s.B,d.B))):N?(B.push(C),$=R(H,ue("Q"))+R(S,s.A+1)+"&nbsp;&nbsp;"+$,f="",v=""):(v=R(S,s.A),B.push(K)):i==w&&(B.push(z),m.getAttribute("end")?(V=F,B.push(Y)):V=ue(m.getAttribute("type")||"T"),$=r(u).map(fe).join(R(H,V)),v=R(S,j(s.B,new Date)),E=" "),i!=w&&(m.hasAttribute(F)?(V=F,E=m.getAttribute(F)||E):b?(V=g,E=fe(b)):V="U"),(p=be(i,{id:t.replace(/[^a-zA-Z0-9_-]/g,"_")+"_"+(a||s).I,innerHTML:R(k,R(D,s.day)+R(T,"'"+s.N)+R(M,$)+f)+R(x,v+(E?R(L,R(H,V==F?F:ue(V))+R("relation-name",E)):"")),S:{...e.S},onclick:()=>n.show(p)})).part.add(...B),p.setAttribute(h,l.K),$e[s.M].push(p),this?.createElement(p)}r(e.children).map((e=>P(e,c)))};r(Ae.children).map((e=>P(e))),n.attachShadow({mode:"open"}).append(be("style",{innerHTML:ae(de(o),ne+`width:100%;border-bottom:.1em dashed var(--${U});user-select:none;-webkit-user-select:none;-moz-user-select:none`)+ae(":host",me(U,Z)+";font-family:arial;line-height:1.3em;"+a(te).map((([e,t])=>`--${e}:${re("",e,t)};`)).join(""))+ae(H,ne+"width:1em;padding:0 .3em")+ae(f,me(q))+ae(de(j),me(_,G))+ae($,ne+"width:100%;padding-top:.3em;text-align:center;text-transform:uppercase;"+me(J,O))+ae($+de(j),"font-weight:bold;"+me(I,Q))+ae(A,ce(.6))+ae(de(C),oe(re(J)))+ae(de(o)+":hover","cursor:pointer;"+me(X))+ae(de(Y),"color:grey")+ae(k,"")+ae(D,ne+"width:1em;text-align:right;padding:0 .5em")+ae(T,"zoom:.8")+ae(M,"font-weight:bold;padding:0 .5em")+ae(x,"float:right")+ae(L,ne+"width:7.5em")+ge(4,3)+`@media screen and (min-width:1000px){${ge(3,4)}}`+`@media screen and (min-width:800px){${ge(2,6)}}`+`@media screen and (max-width:600px){${ge(1,12)}}`+ae(he(le(R))+" "+A,ne)+ae(he(pe(le(R)))+" "+A+pe(de(N)),ie)+ae(he(pe(le(R)))+" "+A+de(N),ne)+ae(de(N),oe("#ffa500!important;"))+ae(he(le(B))+" "+w,ne)+ae(he(pe(le(B)))+" "+w,ie)+ae(he(pe(le(B))+","+pe(le("showdivorces")))+" "+w+de(Y),ie)+ae(he(le(B))+" "+w,ne+";"+ie)}),n.ac=be("style"),be("slot",{name:"header"}),n.grid=be(b,{part:b}),be("slot",{name:"footer"})),n.grid.append(...a($e).map((([e,t],a,r,{M:l,day:o,year:s}=d(c),h=(l==e?"":"not")+j,p=be(f,{part:h+" "+f}))=>(p.append(be($,{part:h+" "+$,innerHTML:(l==e?o:"")+" "+i[a]+" "+(l==e?s:"")}),n[e]=be(v,{part:h+v})),n[e].append(...t.sort(((e,t)=>e.S.E.day-t.S.E.day))),p))))};let ve=async(e,t)=>{s++;for(let a of e.split(",").map((e=>e.toLowerCase()))){let e=await fetch("./calendars/family-"+a+".html");Me(await e.text(),t||ee)}--s||this.render()},Me=(e="",t,a=be(h,{innerHTML:e}))=>{for(let e of a.querySelectorAll("branch:empty"))ve(e.getAttribute(V),e);t.append(a)};ve(n.getAttribute("family")),n.show=(e,t=(e,t,a=le(B),r=pe(a),n=de(z),i=pe(e))=>ae(e,ne+oe(t))+ae(e+n,ne)+ae(he(r)+" "+n+i,ie)+ae(he(r)+" "+w+n+e,ne)+ae(he(a)+" "+w+n+i,ne)+ae(A+e,ne+ce(1)))=>{if("string"==typeof e&&(e=n.person(e)),!e)return n.ac.innerHTML="";e.S.K&&(e=e.S.K);let[a,r]=e;e.length<4&&(r=a),n.ac.innerHTML=t(se(r),re(W))+ae(he(pe(le(R)))+" "+A+se(r),ne+ce(.9))+t(se(a),re(P))}}})})(document,Object.assign,Object.entries,Array.from);